// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Item {
  // books, copies, pen pencils etc
  STATIONERY
  // Medicine
  MEDICINE
  // Fast food
  FOOD
  // Movie tickets, railway tickets
  TICKETS
  // Drinking Water
  PURIFIED_WATER
  // Fruits/Vegetables
  GROCERY
  // Auto
  TRANSPORT
  // Other
  OTHER
}

enum BountyStatus {
  // Just offered, open for claims
  OFFERED
  // Claimed by someone
  CLAIMED
  // Marked completed by poster, Bounty done
  COMPLETED
  // Cancelled by poster or expired
  CANCELLED
}

model User {
  id    String @id @default(uuid())
  email String @unique @db.VarChar(255)
  name  String @db.VarChar(100)
  phone String @db.VarChar(12)

  // Bounties created by the user
  postedBounties Bounty[] @relation("PostedBounties")

  // Bounties claimed by the user
  claimedBounties Bounty[] @relation("ClaimedBounties")

  subscriptions Subscription[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Bounty {
  id          String       @id @default(uuid())
  item        Item
  details     String?      @db.Text
  reward      Int? // TIP in INR, optional
  destination String?      @db.VarChar(255) // Where to deliver the item
  deadline    DateTime?
  status      BountyStatus @default(OFFERED)

  poster   User?   @relation("PostedBounties", fields: [posterId], references: [id])
  posterId String?

  claimer   User?     @relation("ClaimedBounties", fields: [claimerId], references: [id])
  claimerId String?
  claimedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Subscription {
  id         String   @id @default(uuid())
  endpoint   String   @unique @db.Text
  keysAuth   String   @db.Text
  keysP256dh String   @db.Text
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  userAgent  String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@unique([userId, endpoint])
}
